(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1e104180"],{"0d71":function(t,e,a){},a65c:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"h-full"},[a("div",{staticClass:"flex w-full justify-between"},[a("div",[a("el-button",{attrs:{type:"success",round:"",icon:"el-icon-plus"},on:{click:t.addCustomer}},[t._v("添加客户")])],1),t._v(" "),a("div",[a("el-button",{attrs:{icon:"el-icon-search",circle:""}})],1)]),t._v(" "),a("div",{staticClass:"bg-white h-16 w-full mt-5 px-10 flex"},t._l(t.tabs,(function(e,s){return a("div",{key:s,staticClass:"flex flex-col  w-32 h-full text-sm justify-end items-start tabs-item cursor-pointer",class:{"tabs-item--active":t.params.is_protect===e.is_protect},on:{click:t.changeIndex}},[a("div",[a("xy-icon",{staticClass:"text-gray-600",attrs:{type:e.icon}}),t._v(" "),a("span",[t._v(t._s(e.name))])],1),t._v(" "),a("div",{staticClass:"h-1 w-24 mt-4 tabs-bar"})])})),0),t._v(" "),a("div",{staticClass:"bg-white w-full mt-5 px-10 py-10"},[a("div",{staticClass:"flex justify-between w-full"},[a("div",{staticClass:"flex"},[a("el-input",{attrs:{placeholder:"请输入客户名称"},model:{value:t.params.name,callback:function(e){t.$set(t.params,"name",e)},expression:"params.name"}}),t._v(" "),a("div",[a("el-date-picker",{staticClass:"ml-5",attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.dueDates,callback:function(e){t.dueDates=e},expression:"dueDates"}})],1),t._v(" "),a("el-button",{staticClass:"ml-5",attrs:{type:"success",round:""},on:{click:t.searchEvent}},[t._v("搜索")])],1),t._v(" "),a("div",[a("el-button",{attrs:{size:"small",round:""},on:{click:t.exportCsvEvent}},[t._v("导出")])],1)]),t._v(" "),a("vxe-table",{ref:"xTable",staticClass:"mt-8",attrs:{border:"",resizable:"",loading:t.loading,"start-index":(t.tablePage.currentPage-1)*t.tablePage.pageSize,"pager-config":t.tablePage,data:t.tableData}},[a("vxe-table-column",{attrs:{type:"selection",width:"60"}}),t._v(" "),a("vxe-table-column",{attrs:{field:"name",title:"客户名称"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("div",{staticClass:"cursor-pointer",on:{click:function(e){return t.showCustomer(s)}}},[t._v("\n            "+t._s(s.name)+"\n          ")]),t._v(" "),!t.params.is_protect&&s.tag?a("div",[a("el-tag",{attrs:{type:"warning",size:"mini"}},[t._v("\n              "+t._s(s.tag.title)+"\n            ")])],1):t._e()]}}])}),t._v(" "),a("vxe-table-column",{attrs:{field:"address",title:"地址"}}),t._v(" "),a("vxe-table-column",{attrs:{field:"contact",title:"联系人"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("div",[t._v("\n            "+t._s(s.contact)+"\n          ")]),t._v(" "),a("div",[t._v("\n            "+t._s(s.phone)+"\n          ")])]}}])}),t._v(" "),a("vxe-table-column",{attrs:{field:"dueDate",title:t.params.is_protect?"到期时间":"添加时间"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[t.params.is_protect?a("div",[a("div",[t._v("\n              "+t._s(s.protect_end)+"\n            ")]),t._v(" "),a("div",[a("span",{staticClass:"diff-warn"},[t._v("\n                "+t._s(t._f("diffDueDate")(s.protect_end))+"\n              ")])])]):a("div",[t._v("\n            "+t._s(s.created_at)+"\n          ")])]}}])}),t._v(" "),a("vxe-table-column",{attrs:{title:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[t.params.is_protect?a("el-button",{on:{click:function(e){return t.removeEvent(s)}}},[t._v("移除")]):a("div",[a("el-button",{attrs:{size:"small",circle:"",icon:"el-icon-delete"},on:{click:function(e){return t.deleteEvent(s)}}}),t._v(" "),s.is_protect?a("el-button",{attrs:{size:"small",circle:"",type:"success"}},[t._v("保")]):a("el-button",{attrs:{size:"small",circle:"",type:"success",plain:""},on:{click:function(e){return t.protectEvent(s)}}},[t._v("保")])],1)]}}])})],1),t._v(" "),a("vxe-pager",{attrs:{loading:t.loading,"current-page":t.tablePage.currentPage,"page-size":t.tablePage.pageSize,total:t.tablePage.total,layouts:["PrevPage","JumpNumber","NextPage","FullJump","Sizes","Total"]},on:{"page-change":t.handlePageChange}})],1),t._v(" "),a("vxe-modal",{staticClass:"add-modal",attrs:{width:"600","show-header":!0,title:"添加客户","show-footer":!0},model:{value:t.adding,callback:function(e){t.adding=e},expression:"adding"}},[[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px","label-position":"top"}},[a("div",{staticClass:"px-8"},[a("div",{staticClass:"flex items-center"},[a("el-form-item",{staticClass:"flex-1",attrs:{label:"客户名称",prop:"name",rules:[{required:!0,message:"请输入客户名称",trigger:"blur"}]}},[a("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),a("div",{staticClass:"flex-1 flex justify-end"},[a("div",{staticClass:"flex flex-col justify-center items-center border w-16 h-16 cursor-auto",class:t.form.is_protect?"bg-green-300 text-white":"bg-white text-green-300",on:{click:function(e){return t.changeIndex2()}}},[a("xy-icon",{attrs:{type:"baohu1",size:"1.2rem"}}),t._v(" "),a("div",{staticClass:"mt-2 text-mini"},[t._v("\n                  保护客户\n                ")])],1)])],1),t._v(" "),a("div",{staticClass:"flex justify-between"},[a("el-form-item",{staticClass:"flex-1",attrs:{label:"联系人",prop:"contact",rules:[{required:!0,message:"请输入联系人",trigger:"blur"}]}},[a("el-input",{model:{value:t.form.contact,callback:function(e){t.$set(t.form,"contact",e)},expression:"form.contact"}})],1),t._v(" "),a("div",{staticClass:"w-2"}),t._v(" "),a("el-form-item",{staticClass:"flex-1",attrs:{label:"手机号码",prop:"phone",rules:[{required:!0,message:"请输入手机号码",trigger:"blur"}]}},[a("el-input",{model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"地址",prop:"address",rules:[{required:!0,message:"请输入地址",trigger:"blur"}]}},[a("el-input",{model:{value:t.form.address,callback:function(e){t.$set(t.form,"address",e)},expression:"form.address"}})],1),t._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!!t.form.is_protect,expression:"!!form.is_protect"}],attrs:{prop:"tag_id",label:"添加标签",rules:t.form.is_protect?[{required:!0,message:"请输入地址",trigger:"blur"}]:[]}},t._l(t.tags,(function(e,s){return a("el-tag",{key:s,attrs:{"disable-transitions":!1,effect:e.id===t.form.tag_id?"dark":"plain"},on:{click:function(a){t.form.tag_id=e.id}}},[t._v("\n              "+t._s(e.title)+"\n            ")])})),1),t._v(" "),a("el-form-item",{attrs:{label:"备注说明"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.form.comments,callback:function(e){t.$set(t.form,"comments",e)},expression:"form.comments"}})],1)],1)])],t._v(" "),a("template",{slot:"footer"},[a("div",{staticClass:"flex justify-end px-8"},[a("el-button",{attrs:{round:""},on:{click:t.cancelAdding}},[t._v("取消")]),t._v(" "),a("div",{staticClass:"w-2"}),t._v(" "),a("el-button",{attrs:{type:"success",round:"",loading:t.form.isLoading},on:{click:t.confirmAdding}},[t._v("确认")])],1)])],2),t._v(" "),a("vxe-modal",{attrs:{width:"600","show-header":!0,title:"客户详情","show-footer":!0},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[[a("el-form",{attrs:{"label-width":"80px","label-position":"top"}},[a("div",{},[a("el-form-item",{attrs:{label:"客户名称"}},[a("div",[t._v(t._s(t.form.name))])]),t._v(" "),a("div",{staticClass:"flex justify-between"},[a("el-form-item",{staticClass:"flex-1",attrs:{label:"联系人"}},[a("el-input",{attrs:{readonly:""},model:{value:t.form.contact,callback:function(e){t.$set(t.form,"contact",e)},expression:"form.contact"}})],1),t._v(" "),a("div",{staticClass:"w-2"}),t._v(" "),a("el-form-item",{staticClass:"flex-1",attrs:{label:"手机号码"}},[a("el-input",{attrs:{readonly:""},model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"地址"}},[a("el-input",{attrs:{readonly:""},model:{value:t.form.address,callback:function(e){t.$set(t.form,"address",e)},expression:"form.address"}})],1),t._v(" "),t.form.is_protect?a("el-form-item",{attrs:{label:"保护时间"}},[a("div",{staticClass:"flex"},[a("div",[t._v(t._s(t.form.protect_start+" ~ "+t.form.protect_end))]),t._v(" "),a("el-button",{staticClass:"ml-3",attrs:{plain:"",round:"",size:"mini",type:"success"},on:{click:t.renew}},[t._v("续保")])],1)]):t._e()],1)])],t._v(" "),a("template",{slot:"footer"},[a("div",{staticClass:"flex justify-end"},[a("el-button",{attrs:{round:""},on:{click:t.cancelShow}},[t._v("取消")]),t._v(" "),a("div",{staticClass:"w-2"}),t._v(" "),a("el-button",{attrs:{type:"success",round:""},on:{click:t.confirmShow}},[t._v("确认")])],1)])],2)],1)},n=[],r=(a("7f7f"),a("96cf"),a("3b8d")),i={name:"Protection",components:{},mixins:[],extends:{},filters:{},provide:{},inject:[],props:{},computed:{},data:function(){return{tabs:[{name:"保护客户",icon:"baohu",is_protect:1},{name:"客户资料",icon:"kehu1",is_protect:0}],show:!1,adding:!1,loading:!1,tablePage:{total:0,currentPage:1,pageSize:10},tableData:[],dueDates:[],params:{name:"",protect_start:"",protect_end:"",is_protect:1},form:{name:"",contact:"",phone:"",address:"",is_protect:0,comments:"",tag_id:"",protect_start:"",protect_end:"",isLoading:!1},tags:[]}},beforeRouteEnter:function(t,e,a){a((function(t){}))},beforeRouteUpdate:function(t,e,a){a()},beforeRouteLeave:function(t,e,a){a()},beforeCreate:function(){},created:function(){this.findList()},beforeMount:function(){},mounted:function(){},beforeUpdate:function(){},updated:function(){},activated:function(){},deactivated:function(){},beforeDestroy:function(){},destroyed:function(){},methods:{findList:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a,s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,this.loading=!0,t.next=4,this.$request.get("/api/protect-customer",{params:{page:this.tablePage.currentPage,limit:this.tablePage.pageSize,name:this.params.name,is_protect:this.params.is_protect,protect_start:this.params.protect_start,protect_end:this.params.protect_end}});case 4:e=t.sent,a=e.data,s=a.total,n=a.data,this.tableData=n,this.tablePage.total=s;case 10:return t.prev=10,this.loading=!1,t.finish(10);case 13:case"end":return t.stop()}}),t,this,[[0,,10,13]])})));function e(){return t.apply(this,arguments)}return e}(),findTags:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$request.get("/api/customer-tag");case 2:e=t.sent,a=e.data,this.tags=a;case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),searchEvent:function(){this.tablePage.currentPage=1,this.findList()},handlePageChange:function(t){var e=t.currentPage,a=t.pageSize;this.tablePage.currentPage=e,this.tablePage.pageSize=a,this.findList()},removeEvent:function(t){var e=this;this.$confirm("您确定要移除保护吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(r["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.$request.post("/api/change-customer",{id:t.id,is_protect:0});case 2:e.findList(),e.$message({type:"success",message:"成功!"});case 4:case"end":return a.stop()}}),a)})))).catch((function(){e.$message({type:"info",message:"已取消"})}))},deleteEvent:function(t){var e=this;this.$confirm("您确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(r["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.$request.delete("/api/protect-customer/".concat(t.id),{is_protect:0});case 2:e.findList(),e.$message({type:"success",message:"成功!"});case 4:case"end":return a.stop()}}),a)})))).catch((function(){e.$message({type:"info",message:"已取消"})}))},protectEvent:function(t){var e=this;this.$confirm("将此客户设为保护客户?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(r["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.$request.post("/api/change-customer",{id:t.id,is_protect:1});case 2:e.findList(),e.$message({type:"success",message:"成功!"});case 4:case"end":return a.stop()}}),a)})))).catch((function(){e.$message({type:"info",message:"已取消"})}))},exportCsvEvent:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,this.loading=!0,t.next=4,this.$request.get("/protection/all",{params:{customer:this.params.customer,name:this.params.name,is_protect:this.params.is_protect}});case 4:e=t.sent,a=e.data,this.$refs.xTable.exportCsv({filename:"保护库.csv",original:!0,isHeader:!0,data:a});case 7:return t.prev=7,this.loading=!1,t.finish(7);case 10:case"end":return t.stop()}}),t,this,[[0,,7,10]])})));function e(){return t.apply(this,arguments)}return e}(),addCustomer:function(){this.adding=!0,this.findTags()},cancelAdding:function(){this.adding=!1},confirmAdding:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,a,s,n,r,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$validate(this,"form");case 2:return t.prev=2,this.form.isLoading=!0,e=this.form,a=e.name,s=e.contact,n=e.phone,r=e.tag_id,i=e.comments,o=e.address,t.next=7,this.$request.post("/api/protect-customer",{name:a,contact:s,phone:n,tag_id:r,comments:i,address:o});case 7:this.adding=!1,this.findList();case 9:return t.prev=9,this.form.isLoading=!1,t.finish(9);case 12:case"end":return t.stop()}}),t,this,[[2,,9,12]])})));function e(){return t.apply(this,arguments)}return e}(),showCustomer:function(t){Object.assign(this.form,t),console.log(this.form),this.show=!0},cancelShow:function(){this.show=!1},confirmShow:function(){this.show=!1},renew:function(){},changeIndex:function(){0===this.params.is_protect?this.params.is_protect=1:this.params.is_protect=0,this.findList()},changeIndex2:function(){0===this.form.is_protect?this.form.is_protect=1:this.form.is_protect=0}}},o=i,c=(a("d044"),a("2877")),l=Object(c["a"])(o,s,n,!1,null,"7d6607cd",null);e["default"]=l.exports},d044:function(t,e,a){"use strict";var s=a("0d71"),n=a.n(s);n.a}}]);